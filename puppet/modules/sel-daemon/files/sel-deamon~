# lib/SEL-Deamon
# Install and start **SEL-Deamon** service

# To enable a minimal set of SEL-Deamon features, add the following to localrc:
#   enable_service sel-deamon
#

# stack.sh
# ---------
# install_sel-deamon
# configure_sel-deamon
# init_sel-deamon
# start_sel-deamon
# stop_sel-deamon
# cleanup_sel-deamon

# Save trace setting
XTRACE=$(set +o | grep xtrace)
set +o xtrace

# Set up default directories
SEL_DEAMON_DIR=$DEST/sel-deamon

# Tell Tempest this project is present
TEMPEST_SERVICES+=,sel-deamon

# configure_sel-deamon - Set config files, create data dirs, etc
function configure_sel-deamon {
    setup_develop $SEL_DEAMON_DIR
}

# start_sel-deamon - Start running processes, including screen
function start_sel-deamon {
    screen_it sel-deamon "uwsgi"
}

# stop_sel-deamon - Stop running processes
function stop_sel-deamon {
    # This will eventually be refactored to work like
    # Solum and Manila (script to kick off a wsgiref server)
    # For now, this will stop uWSGI rather than have it hang
    killall -9 uwsgi

    # This cleans up the PID file, but uses pkill so SEL-Deamon
    # uWSGI emperor process doesn't actually stop
    screen_stop sel-deamon
}

# Restore xtrace
$XTRACE

# Local variables:
# mode: shell-script
# End:
